<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:social="http://spring.io/springsocial"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<link rel="stylesheet" th:href="@{/resources/css/home.css}"
	type="text/css" media="screen"></link>
<link rel="stylesheet" th:href="@{/resources/css/map.css}"
	type="text/css" media="screen"></link>
<title>Comparti Tu Viaje</title>
<script type="text/javascript"
	src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;signed_in=true&amp;libraries=places&amp;sensor=false&amp;key=AIzaSyCXaq1x17sp2J8bDb9v-hwitBf-8GDrJoU"></script>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<!-- ROUTE.JS -->
<script>
  // <![CDATA[

  //]]>
</script>

<!-- UTILITIES.JS -->
<script>
  // <![CDATA[
  function pulsar(e) {
    tecla = (document.all) ? e.keyCode : e.which;
    return (tecla != 13);
  }
  //]]>
</script>

<!-- FECHA.JS -->
<script>
  // <![CDATA[
  function dateValidate(inputField) {
    var pickeddate = new Date(inputField.value);
    var todayDate = new Date();
    var maxDate = new Date(todayDate.getFullYear() + 2, todayDate.getMonth(), todayDate.getDate());

    if (pickeddate >= todayDate && pickeddate <= maxDate) {
      return true;
    } else {
      inputField.valueAsDate = new Date()
    }
  }

  //COLOCAR MINIMO Y MAXIMO
  $(function() {
    var dtToday = new Date();
    var month = dtToday.getMonth() + 1;
    var day = dtToday.getDate();
    var year = dtToday.getFullYear();
    if (month < 10)
      month = '0' + month.toString();
    if (day < 10)
      day = '0' + day.toString();
    var minDate = year + '-' + month + '-' + day;
    var maxDate = year + 2 + '-' + month + '-' + day;

    $('#fecha-Crear').attr('min', minDate);
    $('#fecha-Crear').attr('max', maxDate);
    $('#fecha-Buscar').attr('max', maxDate);
    $('#fecha-Crear').val(minDate);
  });
  //]]>
</script>

<!-- INITIALIZE_MAP.JS -->
<script>
  // <![CDATA[
  var directionsDisplay;
  var directionsService = new google.maps.DirectionsService();
  var map;

  function initialize() {
    //INITIALIZE GOOGLE MAP
    var center = new google.maps.LatLng(-37.5961848,-43.8441229);
    var myOptions = {
      zoom : 1,
      center : center,
      mapTypeId : google.maps.MapTypeId.ROADMAP,
      mapTypeControl : true
    };
    
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
        map.setZoom(12);
      },function() {
        //SI FALLA NO HACER NADA 
        alert("ERROR GETTING LAT AND LONG FROM GEOLOCATION");
      });
    } else {
      alert("NO GEOLOCATIN");
    }
    
    var rendererOptions = {
      draggable : false,
      map : map
    };
    directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

    //AUTOCOMPLETE FIELDS
    var dc = document.getElementById('desde-crear');
    var hc = document.getElementById('hasta-crear');
    var db = document.getElementById('desde-buscar');
    var hb = document.getElementById('hasta-buscar');
    var autocomplete = new google.maps.places.Autocomplete(dc);
    var autocomplete = new google.maps.places.Autocomplete(hc);
    var autocomplete = new google.maps.places.Autocomplete(db);
    var autocomplete = new google.maps.places.Autocomplete(hb);

  }

  //OBTENER LA RUTA
  function calcRoute() {
    var start = document.getElementById("desde-crear").value;
    var end = document.getElementById("hasta-crear").value;
    var request = {
      origin : start,
      destination : end,
      travelMode : google.maps.TravelMode.DRIVING,
      unitSystem: google.maps.UnitSystem.IMPERIAL,
      provideRouteAlternatives: true
    };
    directionsService.route(request, function(result, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(result);
      }
      //TODO MANEJO DE EXEPCIONES https://developers.google.com/maps/documentation/javascript/directions?hl=es
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);
  //]]>
</script>
</head>
<body>
	<div id="header">
		<h1>
			<a th:href="@{/}">Comparti Tu Viaje</a>
		</h1>
	</div>

	<img src="#"
		th:src="@{'http://graph.facebook.com/' +  ${profileInfo.id}} + '/picture'"
		alt="profile image" />
	<div id="content" layout:fragment="content">
		<p>
			Bienvenido, <span th:text="${account.firstName}">first-name</span>!
		</p>

		<form method="POST" th:action="@{/signout}">
			<button>Sign Out</button>
		</form>
	</div>
	<div class="forms-content">

		<!-- CREAR VIAJE -->
		<form name="crear-viaje" onkeypress="return pulsar(event)"
			id="crear-viaje" th:action="@{/crearVIaje} " method="POST">
			<h4 id="h4">Crear Viaje Nuevo</h4>
			<fieldset>
				<label for="desde">Desde:</label> <input id="desde-crear"
					onblur="calcRoute();" type="text" name="desde"
					placeholder="Ingresa desde donde sales" /> <label for="hasta">Hasta:</label>
				<input id="hasta-crear" onblur="calcRoute();" type="text"
					name="hasta" placeholder="Ingresa hasta donde vas" /> <label
					for="fecha">Fecha:</label> <input id="fecha-Crear" type="date"
					name="fecha" onblur="return dateValidate(this)" /> <label
					for="cupos">Cupos:</label> <input type="text" name="cupos" /> <label
					for="costo">Costo por cabeza:</label> <input type="text"
					name="costo" />
			</fieldset>
			<button id="boton-crear" type="submit">Crear!</button>
		</form>

		<div id="map_canvas" style="width: 100%; height: 300px"></div>

		<!-- BUSCAR VIAJE -->
		<form name="buscar-viaje" onkeypress="return pulsar(event)"
			id="buscar-viaje" th:action="@{/search}" method="GET">
			<h4 id="h4">Buscar un Viaje</h4>
			<fieldset>
				<label for="desde">Desde:</label> <input id="desde-buscar"
					type="text" name="desde" placeholder="Ingresa desde donde sales" />
				<label for="hasta">Hasta:</label> <input id="hasta-buscar"
					type="text" name="hasta" placeholder="Ingresa hasta donde vas" />
				<label for="costo">Costo maximo:</label> <input type="text"
					name="costo" /> <label for="fecha">Fecha:</label> <input
					id="fecha-Buscar" type="date" name="fecha" />
			</fieldset>
			<button id="boton-buscar" type="submit">Buscar!</button>
		</form>
	</div>
</body>
</html>